<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STAY NAVY - Premium Digital Planner</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <style>
    body { font-family: 'Pretendard', sans-serif; background-color: #f0f4f8; color: #0f172a; }
    .navy-bg { background-color: #0f172a; }
    .navy-text { color: #0f172a; }
    .planner-card { background: white; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
    .timer-font { font-family: 'Courier New', Courier, monospace; font-weight: bold; }
    .sidebar-active { background-color: #1e293b; border-left: 4px solid #64748b; }
    /* 타이머 버튼 스타일 (사진 참고) */
    .timer-btn { background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 9999px; padding: 4px 12px; font-size: 10px; font-weight: bold; color: #64748b; transition: all 0.2s; }
    .timer-btn:hover { background: #f1f5f9; border-color: #94a3b8; color: #0f172a; }
    .timer-btn-primary { background: #0f172a; color: white; border: none; }
    .timer-btn-primary:hover { background: #1e293b; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyAjMdVJpejNYvn1fjSh8d2wgs_xtNivP0w",
      authDomain: "xzxsdfgyuio.firebaseapp.com",
      projectId: "xzxsdfgyuio",
      storageBucket: "xzxsdfgyuio.firebasestorage.app",
      messagingSenderId: "196701833344",
      appId: "1:196701833344:web:132d69399ce5b2f6b0fe65"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [view, setView] = useState('dashboard');
      const [todos, setTodos] = useState([]);
      const [lectures, setLectures] = useState([]);
      const [cumulativeTime, setCumulativeTime] = useState(0);
      const [isTimerRunning, setIsTimerRunning] = useState(false);
      const [timeRecords, setTimeRecords] = useState({});

      useEffect(() => {
        return auth.onAuthStateChanged(u => {
          setUser(u);
          if (u) loadData(u.uid);
          setLoading(false);
        });
      }, []);

      const loadData = async (uid) => {
        const doc = await db.collection('planners').doc(uid).get();
        if (doc.exists) {
          const data = doc.data();
          setTodos(data.todos || []);
          setLectures(data.lectures || []);
          setCumulativeTime(data.cumulativeTime || 0);
          setTimeRecords(data.timeRecords || {});
        }
      };

      useEffect(() => {
        if (!user) return;
        const saver = setTimeout(() => {
          db.collection('planners').doc(user.uid).set({
            todos, lectures, cumulativeTime, timeRecords, lastUpdated: new Date()
          }, { merge: true });
        }, 3000);
        return () => clearTimeout(saver);
      }, [todos, lectures, cumulativeTime, timeRecords]);

      useEffect(() => {
        let interval;
        if (isTimerRunning) {
          interval = setInterval(() => setCumulativeTime(prev => prev + 1), 1000);
        }
        return () => clearInterval(interval);
      }, [isTimerRunning]);

      // 타이머 초기화 함수
      const resetTimer = () => {
        if(confirm("공부 시간을 초기화할까요?")) {
          setCumulativeTime(0);
          setIsTimerRunning(false);
        }
      };

      if (loading) return <div className="min-h-screen flex items-center justify-center">Loading STAY NAVY...</div>;
      if (!user) return <AuthView />;

      return (
        <div className="flex min-h-screen">
          {/* 사이드바 */}
          <aside className="w-64 navy-bg text-white p-6 flex flex-col fixed h-full z-10">
            <div className="mb-10">
              <h1 className="text-2xl font-bold tracking-widest text-slate-200">STAY NAVY</h1>
              <p className="text-[10px] text-slate-500 uppercase tracking-tighter">Study Archive System</p>
            </div>
            <nav className="flex-1 space-y-2 text-xs font-bold tracking-tight">
              <div className={`p-4 rounded-lg cursor-pointer hover:bg-slate-800 transition ${view === 'dashboard' && 'sidebar-active'}`} onClick={() => setView('dashboard')}>DASHBOARD</div>
              <div className={`p-4 rounded-lg cursor-pointer hover:bg-slate-800 transition ${view === 'todo' && 'sidebar-active'}`} onClick={() => setView('todo')}>TO-DO LIST</div>
              <div className={`p-4 rounded-lg cursor-pointer hover:bg-slate-800 transition ${view === 'lecture' && 'sidebar-active'}`} onClick={() => setView('lecture')}>LECTURES</div>
              <div className={`p-4 rounded-lg cursor-pointer hover:bg-slate-800 transition ${view === 'record' && 'sidebar-active'}`} onClick={() => setView('record')}>TIME RECORD</div>
            </nav>
            <div className="mt-auto border-t border-slate-700 pt-4 text-[10px] text-slate-400">
              <p className="truncate">{user.email}</p>
              <button onClick={() => auth.signOut()} className="mt-2 text-red-400 hover:underline">LOGOUT</button>
            </div>
          </aside>

          {/* 메인 */}
          <main className="ml-64 flex-1 p-12">
            {view === 'dashboard' && (
              <div className="space-y-10">
                <header className="flex justify-between items-start">
                  <div>
                    <h2 className="text-5xl font-black navy-text tracking-tighter">NAVY LOG.</h2>
                    <p className="text-slate-400 mt-2 font-medium">환영합니다. 당신의 집중을 기록하세요.</p>
                  </div>
                  <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm text-right min-w-[240px]">
                    <p className="text-[10px] font-black text-slate-400 mb-1 uppercase tracking-widest">Cumulative Time</p>
                    <p className="text-5xl timer-font navy-text leading-none mb-4">
                      {Math.floor(cumulativeTime/3600).toString().padStart(2,'0')}:
                      {Math.floor((cumulativeTime%3600)/60).toString().padStart(2,'0')}:
                      {(cumulativeTime%60).toString().padStart(2,'0')}
                    </p>
                    <div className="flex justify-end gap-2">
                      <button onClick={resetTimer} className="timer-btn">RESET</button>
                      <button onClick={() => setIsTimerRunning(!isTimerRunning)} 
                        className={`timer-btn ${isTimerRunning ? 'bg-red-500 text-white border-none' : 'timer-btn-primary text-white'}`}>
                        {isTimerRunning ? 'STOP' : 'START'}
                      </button>
                    </div>
                  </div>
                </header>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  <section className="planner-card p-8">
                    <h3 className="text-sm font-black mb-6 navy-text border-l-4 border-slate-900 pl-3">ACTIVE LECTURES</h3>
                    <div className="space-y-3">
                      {lectures.length === 0 ? <p className="text-xs text-slate-300">No data available.</p> :
                      lectures.map((lec, i) => (
                        <div key={i} className="flex justify-between items-center p-4 bg-slate-50 rounded-xl border border-slate-100">
                          <span className="font-bold text-sm">{lec.title}</span>
                          <span className="text-[10px] font-black navy-bg text-white px-2 py-1 rounded italic">{lec.teacher} T</span>
                        </div>
                      ))}
                    </div>
                  </section>

                  <section className="planner-card p-8">
                    <h3 className="text-sm font-black mb-6 navy-text border-l-4 border-slate-900 pl-3">TODAY'S TASK</h3>
                    <div className="space-y-4">
                      {todos.slice(0, 5).map((t, i) => (
                        <div key={i} className="flex items-center gap-3">
                          <div className={`w-1.5 h-1.5 rounded-full ${t.done ? 'bg-green-400' : 'bg-slate-200'}`}></div>
                          <span className={`text-sm ${t.done ? 'line-through text-slate-300' : 'text-slate-600 font-medium'}`}>{t.text}</span>
                        </div>
                      ))}
                    </div>
                  </section>
                </div>
              </div>
            )}

            {view === 'todo' && <TodoSettings todos={todos} setTodos={setTodos} />}
            {view === 'lecture' && <LectureSettings lectures={lectures} setLectures={setLectures} />}
            {view === 'record' && <TimeRecord records={timeRecords} setRecords={setTimeRecords} />}
          </main>
        </div>
      );
    }

    const TodoSettings = ({ todos, setTodos }) => {
      const [input, setInput] = useState("");
      const add = () => { if(input) { setTodos([...todos, { text: input, done: false }]); setInput(""); } };
      return (
        <div className="max-w-xl mx-auto planner-card p-10 animate-in slide-in-from-bottom-4 duration-500">
          <h3 className="text-xs font-black mb-8 navy-text tracking-[0.3em] uppercase text-center">To-do Management</h3>
          <div className="flex gap-3 mb-8">
            <input className="flex-1 bg-slate-50 border-none rounded-xl p-4 text-sm" value={input} onChange={e => setInput(e.target.value)} placeholder="할 일을 입력하세요" />
            <button onClick={add} className="navy-bg text-white px-8 rounded-xl font-black text-xs transition active:scale-95">ADD</button>
          </div>
          <div className="space-y-3">
            {todos.map((t, i) => (
              <div key={i} className="flex items-center justify-between p-4 bg-white border border-slate-100 rounded-xl shadow-sm">
                <div className="flex items-center gap-4">
                  <input type="checkbox" checked={t.done} onChange={() => {
                    const newTodos = [...todos];
                    newTodos[i].done = !newTodos[i].done;
                    setTodos(newTodos);
                  }} className="w-5 h-5 rounded-full accent-slate-900 cursor-pointer" />
                  <span className={t.done ? 'line-through text-slate-300' : 'font-bold text-slate-700 text-sm'}>{t.text}</span>
                </div>
                <button onClick={() => setTodos(todos.filter((_, idx) => idx !== i))} className="text-slate-300 hover:text-red-400 transition italic text-[10px]">Remove</button>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const LectureSettings = ({ lectures, setLectures }) => {
      const [title, setTitle] = useState("");
      const [teacher, setTeacher] = useState("");
      const add = () => { if(title && teacher) { setLectures([...lectures, { title, teacher }]); setTitle(""); setTeacher(""); } };
      return (
        <div className="max-w-xl mx-auto planner-card p-10 animate-in slide-in-from-bottom-4 duration-500">
          <h3 className="text-xs font-black mb-8 navy-text tracking-[0.3em] uppercase text-center">Lecture Setup</h3>
          <div className="space-y-4 mb-6">
            <input className="w-full bg-slate-50 border-none rounded-xl p-4 text-sm" value={title} onChange={e => setTitle(e.target.value)} placeholder="강좌명 (ex: 뉴런)" />
            <input className="w-full bg-slate-50 border-none rounded-xl p-4 text-sm" value={teacher} onChange={e => setTeacher(e.target.value)} placeholder="선생님" />
          </div>
          <button onClick={add} className="w-full navy-bg text-white py-4 rounded-xl font-black text-xs mb-10 transition active:scale-95 shadow-lg">REGISTER</button>
          <div className="space-y-3">
            {lectures.map((l, i) => (
              <div key={i} className="flex justify-between items-center p-5 bg-slate-900 text-white rounded-2xl shadow-xl">
                <div>
                  <p className="text-[9px] text-slate-500 font-black uppercase mb-1 tracking-widest">Lecture {i+1}</p>
                  <p className="font-black text-sm">{l.title}</p>
                </div>
                <div className="text-right">
                  <p className="text-xs font-bold text-slate-300 italic">{l.teacher} T</p>
                  <button onClick={() => setLectures(lectures.filter((_, idx) => idx !== i))} className="text-[9px] text-slate-600 hover:text-white underline">Delete</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const TimeRecord = ({ records, setRecords }) => {
      const hours = Array.from({ length: 15 }, (_, i) => (i + 8).toString().padStart(2, '0') + ":00");
      return (
        <div className="max-w-3xl mx-auto planner-card p-10">
          <h3 className="text-xs font-black mb-10 navy-text tracking-[0.3em] uppercase text-center">Time Record System</h3>
          <div className="divide-y divide-slate-100">
            {hours.map(h => (
              <div key={h} className="flex items-center hover:bg-slate-50 transition group">
                <span className="w-24 text-[11px] font-black text-slate-400 py-4 font-mono">{h}</span>
                <input 
                  className="flex-1 p-2 text-sm text-slate-700 bg-transparent border-none focus:ring-0"
                  value={records[h] || ""}
                  onChange={e => setRecords({...records, [h]: e.target.value})}
                  placeholder="공부한 내용을 입력하세요..."
                />
              </div>
            ))}
          </div>
        </div>
      );
    };

    // --- 로그인 화면 (구글 로그인 추가) ---
    const AuthView = () => {
      const [email, setEmail] = useState("");
      const [pw, setPw] = useState("");

      const handleGoogleLogin = () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(e => alert(e.message));
      };

      const login = () => auth.signInWithEmailAndPassword(email, pw).catch(e => alert(e.message));
      const signup = () => auth.createUserWithEmailAndPassword(email, pw).catch(e => alert(e.message));
      
      return (
        <div className="min-h-screen flex flex-col items-center justify-center bg-[#0f172a] text-white p-6">
          <div className="mb-12 text-center">
            <h1 className="text-6xl font-black tracking-tighter mb-3">STAY NAVY.</h1>
            <p className="text-slate-500 text-xs tracking-[0.5em] font-bold">DIGITAL ARCHIVE FOR ELITE</p>
          </div>
          <div className="w-full max-w-sm space-y-4">
            <button onClick={handleGoogleLogin} className="w-full bg-white text-black py-4 rounded-xl font-black text-xs flex items-center justify-center gap-3 hover:bg-slate-100 transition shadow-xl">
              <svg className="w-4 h-4" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
              CONTINUE WITH GOOGLE
            </button>
            <div className="relative py-4 flex items-center">
              <div className="flex-grow border-t border-slate-800"></div>
              <span className="px-4 text-[9px] text-slate-600 font-black tracking-widest">OR EMAIL ACCESS</span>
              <div className="flex-grow border-t border-slate-800"></div>
            </div>
            <input className="w-full bg-slate-800 border-none rounded-xl p-4 text-xs font-bold" placeholder="EMAIL ADDRESS" value={email} onChange={e=>setEmail(e.target.value)} />
            <input className="w-full bg-slate-800 border-none rounded-xl p-4 text-xs font-bold" type="password" placeholder="PASSWORD" value={pw} onChange={e=>setPw(e.target.value)} />
            <div className="flex gap-2 pt-4">
              <button onClick={login} className="flex-1 bg-slate-700 text-white p-4 rounded-xl font-black text-[10px] hover:bg-slate-600 transition">LOGIN</button>
              <button onClick={signup} className="flex-1 bg-slate-800 text-slate-400 p-4 rounded-xl font-black text-[10px] hover:text-white transition">SIGN UP</button>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
